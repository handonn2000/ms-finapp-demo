version: "3"

services:
  rabbitmq:
    image: rabbitmq:3.12-management
    ports:
      - "5672:5672"
      - "15672:15672"
    healthcheck:
      test: rabbitmq-diagnostics check_port_connectivity
    extends:
      file: "common-config.yml"
      service: "deploy-config-service"

  configurations-central:
    image: finapp/configuration-central:1.0.0
    container_name: finapp-configuration-central
    ports:
      - "8071:8071"
    healthcheck:
      test: "curl --fail --silent localhost:8071/actuator/health/readiness | grep UP || exit 1"
    depends_on:
      rabbitmq:
        condition: service_healthy
    extends:
      file: "common-config.yml"
      service: "deploy-config-service"

  accounts:
    extends:
      file: "./account/service-compose-config.yml"
      service: "finapp-account-config"
#
#  loans:
#    image: "finapp/loans:1.0.0"
#    container_name: "finapp-loan-service"
#    ports:
#      - "8089:8089"
#    extends:
#      file: "common-config.yml"
#      service: "base-config-service"
#    environment:
#      SPRING_APPLICATION_NAME: loans
#
#  cards:
#    image: "finapp/cards:1.0.0"
#    container_name: "finapp-card-service"
#    ports:
#      - "8090:8090"
#    extends:
#      file: "common-config.yml"
#      service: "base-config-service"
#    environment:
#      SPRING_APPLICATION_NAME: cards

networks:
  finapp:
    driver: bridge